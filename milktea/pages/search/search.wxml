<view class="search-page">
  <!-- æœç´¢æ  -->
  <view class="search-header">
    <view class="search-input-wrapper">
      <input 
        type="text" 
        placeholder="æœç´¢å¥¶èŒ¶ã€å’–å•¡ã€å°é£Ÿ..." 
        value="{{searchKeyword}}"
        bindinput="onInput"
        bindconfirm="onSearch"
        focus="{{true}}"
      />
      <text 
        class="close-icon" 
        wx:if="{{searchKeyword}}" 
        bindtap="clearKeyword"
      >âœ•</text>
    </view>
    <view class="search-action" bindtap="onSearch">
      <text class="search-icon">ğŸ”</text>
    </view>
  </view>

  <!-- æœç´¢å†å² -->
  <view class="search-history" wx:if="{{!showResults && searchHistory.length > 0}}">
    <view class="history-header">
      <text class="history-title">æœç´¢å†å²</text>
      <text class="delete-icon" bindtap="clearHistory">ğŸ—‘ï¸</text>
    </view>
    <view class="history-tags">
      <text 
        class="history-tag" 
        wx:for="{{searchHistory}}" 
        wx:key="*this"
        bindtap="searchByKeyword"
        data-keyword="{{item}}"
      >{{ item }}</text>
    </view>
  </view>

  <!-- çƒ­é—¨æœç´¢ -->
  <view class="hot-search" wx:if="{{!showResults}}">
    <view class="hot-header">
      <text class="hot-title">çƒ­é—¨æœç´¢</text>
    </view>
    <view class="hot-tags">
      <text 
        class="hot-tag {{index < 3 ? 'hot' : ''}}" 
        wx:for="{{hotKeywords}}" 
        wx:key="word"
        bindtap="searchByKeyword"
        data-keyword="{{item.word}}"
      >{{ index + 1 }}. {{ item.word }}</text>
    </view>
  </view>

  <!-- æœç´¢ç»“æœ -->
  <view class="search-results" wx:if="{{showResults}}">
    <!-- ç»“æœç±»å‹åˆ‡æ¢ -->
    <view class="search-tabs">
      <view
        class="tab-item {{searchType === 'product' ? 'active' : ''}}"
        bindtap="switchType"
        data-type="product"
      >å•†å“ ({{ filteredProducts.length }})</view>
      <view
        class="tab-item {{searchType === 'store' ? 'active' : ''}}"
        bindtap="switchType"
        data-type="store"
      >é—¨åº— ({{ filteredStores.length }})</view>
    </view>

    <!-- å•†å“æœç´¢ç»“æœ -->
    <block wx:if="{{searchType === 'product'}}">
      <view class="results-header">
        <view class="sort-options">
          <text
            class="sort-option {{sortBy === 'default' ? 'active' : ''}}"
            bindtap="changeSort"
            data-sort="default"
          >ç»¼åˆ</text>
          <text
            class="sort-option {{sortBy === 'sales' ? 'active' : ''}}"
            bindtap="changeSort"
            data-sort="sales"
          >é”€é‡</text>
          <text
            class="sort-option {{sortBy === 'price_asc' ? 'active' : ''}}"
            bindtap="changeSort"
            data-sort="price_asc"
          >ä»·æ ¼ â†‘</text>
          <text
            class="sort-option {{sortBy === 'price_desc' ? 'active' : ''}}"
            bindtap="changeSort"
            data-sort="price_desc"
          >ä»·æ ¼ â†“</text>
        </view>
      </view>

      <view class="product-list" wx:if="{{filteredProducts.length > 0}}">
        <view class="product-grid">
          <product-card
            wx:for="{{filteredProducts}}"
            wx:key="id"
            product="{{item}}"
            isFavorite="{{favoriteIds[item.id]}}"
            bindtap="onProductTap"
            data-id="{{item.id}}"
            bind:favorite-change="onFavoriteChange"
          />
        </view>
      </view>
      <view class="empty-results" wx:else>
        <view class="empty-icon">ğŸ”</view>
        <text class="empty-text">æ²¡æœ‰æ‰¾åˆ°ç›¸å…³å•†å“</text>
      </view>
    </block>

    <!-- é—¨åº—æœç´¢ç»“æœ -->
    <block wx:else>
      <view class="store-list" wx:if="{{filteredStores.length > 0}}">
        <view
          class="store-item"
          wx:for="{{filteredStores}}"
          wx:key="id"
          bindtap="onStoreTap"
          data-id="{{item.id}}"
        >
          <view class="store-info">
            <view class="store-name">{{ item.name }}</view>
            <view class="store-address">{{ item.address }}</view>
            <view class="store-status">
              <text class="status-tag {{item.status}}">{{ item.status === 'OPEN' ? 'è¥ä¸šä¸­' : 'ä¼‘æ¯ä¸­' }}</text>
              <text class="distance" wx:if="{{item.distance}}">{{ item.distance }}km</text>
            </view>
          </view>
          <view class="store-action">
            <text class="go-btn">å»ä¸‹å•</text>
          </view>
        </view>
      </view>
      <view class="empty-results" wx:else>
        <view class="empty-icon">ğŸª</view>
        <text class="empty-text">æ²¡æœ‰æ‰¾åˆ°ç›¸å…³é—¨åº—</text>
      </view>
    </block>
  </view>
</view>