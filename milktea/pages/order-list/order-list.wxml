<view class="order-list-page">
  <!-- æ ‡ç­¾é¡µ -->
  <view class="tabs">
    <view
      class="tab {{activeTab === item.key ? 'active' : ''}}"
      wx:for="{{tabs}}"
      wx:key="key"
      bindtap="switchTab"
      data-key="{{item.key}}"
    >
      {{item.name}}
    </view>
  </view>

  <!-- ç­›é€‰ä¸æ’åºæ  -->
  <view class="filter-bar">
    <view class="search-box">
      <text class="search-icon">ğŸ”</text>
      <input
        value="{{searchKeyword}}"
        placeholder="æœç´¢è®¢å•å·"
        class="search-input"
        bindinput="onSearchInput"
      />
    </view>
    <view class="sort-box">
      <picker bindchange="onSortChange" value="{{sortIndex}}" range="{{sortOptions}}" range-key="name">
        <view class="sort-select">
          {{sortOptions[sortIndex].name}}
        </view>
      </picker>
    </view>
  </view>

  <!-- è®¢å•åˆ—è¡¨ -->
  <view class="orders" wx:if="{{filteredOrders.length > 0}}">
    <view
      class="order-item"
      wx:for="{{filteredOrders}}"
      wx:key="id"
      bindtap="goToOrderDetail"
      data-no="{{item.orderNo}}"
    >
      <!-- è®¢å•å¤´éƒ¨ -->
      <view class="order-header">
        <text class="order-no">è®¢å•å·ï¼š{{item.orderNo}}</text>
        <text class="order-status {{item.status}}">{{item.statusText}}</text>
      </view>

      <!-- è®¢å•è¿›åº¦æ¡ -->
      <view class="order-progress-container">
        <view class="progress-bar">
          <view class="progress-inner" style="width: {{item.progressWidth}}"></view>
        </view>
        <view class="progress-steps">
          <view class="step {{item.step >= 1 ? 'active' : ''}}">
            <view class="step-dot"></view>
            <text class="step-text">ä¸‹å•</text>
          </view>
          <view class="step {{item.step >= 2 ? 'active' : ''}}">
            <view class="step-dot"></view>
            <text class="step-text">æ”¯ä»˜</text>
          </view>
          <view class="step {{item.step >= 3 ? 'active' : ''}}">
            <view class="step-dot"></view>
            <text class="step-text">åˆ¶ä½œ</text>
          </view>
          <view class="step {{item.step >= 4 ? 'active' : ''}}">
            <view class="step-dot"></view>
            <text class="step-text">å¾…å–</text>
          </view>
          <view class="step {{item.step >= 5 ? 'active' : ''}}">
            <view class="step-dot"></view>
            <text class="step-text">å®Œæˆ</text>
          </view>
        </view>
      </view>

      <!-- å•†å“åˆ—è¡¨ -->
      <view class="goods-list">
        <view class="goods-item" wx:for="{{item.items}}" wx:for-item="goods" wx:key="id">
          <image class="goods-image" src="{{goods.image}}" mode="aspectFill" />
          <view class="goods-info">
            <text class="goods-name">{{goods.name}}</text>
            <view class="goods-bottom">
              <text class="goods-price">Â¥{{goods.price}}</text>
              <text class="goods-quantity">Ã—{{goods.quantity}}</text>
            </view>
          </view>
        </view>
      </view>

      <!-- è®¢å•ä¿¡æ¯ -->
      <view class="order-info">
        <view class="info-row">
          <text class="label">ä¸‹å•æ—¶é—´</text>
          <text class="value">{{item.createTime}}</text>
        </view>
        <view class="info-row" wx:if="{{item.pickupCode}}">
          <text class="label">å–é¤ç </text>
          <text class="pickup-code">{{item.pickupCode}}</text>
        </view>
        <view class="info-row total">
          <text class="label">å®ä»˜æ¬¾</text>
          <text class="amount">Â¥{{item.totalAmount}}</text>
        </view>
      </view>

      <!-- æ“ä½œæŒ‰é’® -->
      <view class="order-actions">
        <!-- å¾…æ”¯ä»˜ -->
        <block wx:if="{{item.status === 'PENDING_PAYMENT'}}">
          <button class="action-btn secondary" catchtap="cancelOrder" data-no="{{item.orderNo}}">å–æ¶ˆè®¢å•</button>
          <button class="action-btn primary" catchtap="payOrder" data-item="{{item}}">ç«‹å³ä»˜æ¬¾</button>
        </block>

        <!-- åˆ¶ä½œä¸­ -->
        <block wx:elif="{{item.status === 'PAID' || item.status === 'MAKING'}}">
          <button class="action-btn secondary" catchtap="contactService">è”ç³»å®¢æœ</button>
          <button class="action-btn primary" catchtap="remindOrder" data-no="{{item.orderNo}}">å‚¬å•</button>
        </block>

        <!-- å¾…å–é¤ -->
        <block wx:elif="{{item.status === 'READY'}}">
          <button class="action-btn secondary" catchtap="contactService">è”ç³»å®¢æœ</button>
          <button class="action-btn primary" catchtap="confirmOrder" data-no="{{item.orderNo}}">ç«‹å³å–é¤</button>
        </block>

        <!-- å·²å®Œæˆ -->
        <block wx:elif="{{item.status === 'COMPLETED' || item.status === 'FINISHED' || item.status === 'REVIEWED'}}">
          <button class="action-btn secondary" catchtap="reorder" data-item="{{item}}">å†æ¥ä¸€å•</button>
          <button class="action-btn primary" wx:if="{{item.status !== 'REVIEWED'}}" catchtap="reviewOrder" data-no="{{item.orderNo}}">ç«‹å³è¯„ä»·</button>
        </block>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:elif="{{!loading}}">
    <view class="empty-icon">ğŸ“‹</view>
    <view class="empty-text">æš‚æ— è®¢å•</view>
    <button class="go-shopping-btn" bindtap="goToIndex">å»é€›é€›</button>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-more" wx:if="{{loading}}">
    <text>åŠ è½½ä¸­...</text>
  </view>
</view>