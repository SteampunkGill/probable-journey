<view class="product-detail-page">
  <!-- å•†å“å›¾ç‰‡åŒºåŸŸ -->
  <view class="product-images">
    <swiper class="swiper-container" indicator-dots circular bindchange="onImageChange">
      <swiper-item wx:for="{{product.images}}" wx:key="*this">
        <image src="{{item}}" class="product-image" mode="aspectFill" />
      </swiper-item>
    </swiper>
    <view class="image-indicator">
      {{currentImageIndex + 1}}/{{product.images.length || 0}}
    </view>
    
    <!-- æ”¶è—æŒ‰é’® -->
    <view 
      class="favorite-btn {{isFavorite ? 'active' : ''}}" 
      bindtap="toggleFavorite"
    >
      <text class="favorite-icon">{{isFavorite ? 'â¤ï¸' : 'ğŸ¤'}}</text>
    </view>
  </view>

  <!-- å•†å“åŸºæœ¬ä¿¡æ¯ -->
  <view class="product-basic-info card">
    <view class="product-header">
      <view class="product-name">{{product.name}}</view>
      <view class="product-tags">
        <text class="tag tag-hot" wx:if="{{product.isHot}}">ğŸ”¥ çƒ­é”€</text>
        <text class="tag tag-new" wx:if="{{product.isNew}}">âœ¨ æ–°å“</text>
        <text class="tag tag-recommend" wx:if="{{product.isRecommend}}">ğŸ‘ æ¨è</text>
      </view>
    </view>
    
    <view class="product-meta">
      <view class="price-section">
        <text class="current-price">Â¥{{product.price}}</text>
        <text class="original-price" wx:if="{{product.originalPrice > product.price}}">
          Â¥{{product.originalPrice}}
        </text>
      </view>
      
      <view class="rating-section">
        <view class="rating-stars">
          <text wx:for="{{5}}" wx:key="*this" class="star">â­</text>
        </view>
        <text class="rating-text">{{product.rating}}åˆ†</text>
        <text class="sales-text">å·²å”®{{product.sales}}ä»¶</text>
      </view>
    </view>
    
    <view class="product-desc">{{product.description}}</view>
  </view>

  <!-- å®šåˆ¶åŒ–é€‰é¡¹ -->
  <view class="customization-section card">
    <view class="section-title">âš™ å®šåˆ¶ä½ çš„ä¸“å±é¥®å“</view>
    
    <!-- ç”œåº¦é€‰æ‹© -->
    <view class="customization-item">
      <view class="item-header">
        <text class="item-label">ç”œåº¦</text>
        <text class="item-required">å¿…é€‰</text>
      </view>
      <view class="option-group">
        <view 
          class="option-item {{customizations.sweetness === item.value ? 'selected' : ''}}" 
          wx:for="{{sweetnessOptions}}" 
          wx:key="value"
          bindtap="selectSweetness"
          data-value="{{item.value}}"
        >
          <text class="option-label">{{item.label}}</text>
          <text class="option-hint">{{item.hint}}</text>
        </view>
      </view>
    </view>

    <!-- æ¸©åº¦é€‰æ‹© -->
    <view class="customization-item">
      <view class="item-header">
        <text class="item-label">æ¸©åº¦</text>
        <text class="item-required">å¿…é€‰</text>
      </view>
      <view class="option-group">
        <view 
          class="option-item {{customizations.temperature === item.value ? 'selected' : ''}}" 
          wx:for="{{temperatureOptions}}" 
          wx:key="value"
          bindtap="selectTemperature"
          data-value="{{item.value}}"
        >
          <text class="option-label">{{item.label}}</text>
        </view>
      </view>
    </view>

    <!-- åŠ æ–™é€‰æ‹© -->
    <view class="customization-item">
      <view class="item-header">
        <text class="item-label">åŠ æ–™</text>
        <text class="item-hint">å¯é€‰ï¼Œæœ€å¤šé€‰æ‹©{{maxToppings}}ç§</text>
      </view>
      <view class="toppings-grid">
        <view 
          class="topping-item {{utils.includes(customizations.toppings, item.id) ? 'selected' : ''}}" 
          wx:for="{{toppingOptions}}" 
          wx:key="id"
          bindtap="toggleTopping"
          data-item="{{item}}"
        >
          <view class="topping-info">
            <text class="topping-name">{{item.name}}</text>
            <text class="topping-price">+Â¥{{item.price}}</text>
          </view>
          <view class="topping-check" wx:if="{{utils.includes(customizations.toppings, item.id)}}">âœ“</view>
        </view>
      </view>
    </view>
  </view>

  <!-- å•†å“è¯¦æƒ…æ ‡ç­¾é¡µ -->
  <view class="product-detail-section card">
    <view class="detail-tabs">
      <view 
        class="tab-item {{activeTab === 0 ? 'active' : ''}}" 
        bindtap="switchTab"
        data-index="0"
      >å•†å“è¯¦æƒ…</view>
      <view 
        class="tab-item {{activeTab === 1 ? 'active' : ''}}" 
        bindtap="switchTab"
        data-index="1"
      >è¥å…»æˆåˆ†</view>
      <view 
        class="tab-item {{activeTab === 2 ? 'active' : ''}}" 
        bindtap="switchTab"
        data-index="2"
      >ç”¨æˆ·è¯„ä»·</view>
    </view>
    
    <view class="tab-content" wx:if="{{activeTab === 0}}">
      <rich-text nodes="{{product.detailHtml}}"></rich-text>
    </view>
    
    <view class="tab-content nutrition" wx:if="{{activeTab === 1}}">
      <view class="nutrition-table">
        <view class="nutrition-row" wx:for="{{product.nutrition}}" wx:key="name">
          <text>{{item.name}}</text>
          <text>{{item.value}}{{item.unit}}</text>
        </view>
      </view>
    </view>
    
    <view class="tab-content comments" wx:if="{{activeTab === 2}}">
      <view class="comment-list">
        <view class="comment-item" wx:for="{{comments}}" wx:key="id">
          <view class="comment-header">
            <image src="{{item.userAvatar}}" class="user-avatar" mode="aspectFill" />
            <view class="user-info">
              <text class="user-name">{{item.userName}}</text>
              <view class="comment-rating">â­ {{item.rating}}</view>
            </view>
            <text class="comment-time">{{item.createTime}}</text>
          </view>
          <view class="comment-content">{{item.content}}</view>
        </view>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨æ“ä½œæ  -->
  <view class="bottom-action-bar">
    <view class="bottom-left">
      <view class="cart-icon" bindtap="goToCart">
        <text class="icon">ğŸ›’</text>
        <view class="cart-badge" wx:if="{{cartCount > 0}}">{{cartCount}}</view>
      </view>
      <view class="price-info">
        <text class="total-label">åˆè®¡ï¼š</text>
        <text class="total-price">Â¥{{totalPrice}}</text>
      </view>
    </view>
    
    <view class="bottom-right">
      <button class="add-to-cart-btn" bindtap="addToCart">åŠ å…¥è´­ç‰©è½¦</button>
      <button class="buy-now-btn" bindtap="buyNow">ç«‹å³è´­ä¹°</button>
    </view>
  </view>
</view>

<wxs module="utils">
module.exports.includes = function(arr, val) {
  if (!arr) return false;
  return arr.indexOf(val) !== -1;
}
</wxs>