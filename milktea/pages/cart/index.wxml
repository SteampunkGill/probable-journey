<view class="cart-page">
  <!-- 购物车头部 -->
  <view class="cart-header">
    <text class="cart-title">购物车</text>
    <view class="cart-actions">
      <text class="edit-btn" bindtap="toggleEdit">
        {{isEditing ? '完成' : '编辑'}}
      </text>
      <text class="clear-btn" bindtap="clearCart" wx:if="{{!isEditing && cartItems.length > 0}}">
        清空
      </text>
    </view>
  </view>

  <!-- 购物车为空 -->
  <view class="empty-cart" wx:if="{{cartItems.length === 0}}">
    <image src="/assets/images/icons/cart.png" class="empty-icon" />
    <text class="empty-text">购物车还是空的哦~</text>
    <text class="empty-hint">去首页逛逛吧</text>
    <button class="btn btn-primary" bindtap="goToHome">去逛逛</button>
  </view>

  <!-- 购物车商品列表 -->
  <view class="cart-list" wx:else>
    <!-- 全选操作 -->
    <view class="select-all-section" wx:if="{{!isEditing}}">
      <view class="select-all-checkbox" bindtap="toggleSelectAll">
        <view class="checkbox {{isAllSelected ? 'checked' : ''}}">
          <text class="iconfont icon-check" wx:if="{{isAllSelected}}"></text>
        </view>
        <text class="select-all-text">全选</text>
      </view>
      <view class="selected-info">
        <text>已选{{selectedCount}}件</text>
      </view>
    </view>

    <!-- 商品列表 -->
    <view class="cart-items">
      <view class="cart-item" wx:for="{{cartItems}}" wx:key="cartItemId">
        <!-- 选择框 -->
        <view class="item-checkbox" bindtap="toggleSelect" data-id="{{item.cartItemId}}" wx:if="{{!isEditing}}">
          <view class="checkbox {{item.selected ? 'checked' : ''}}">
            <text class="iconfont icon-check" wx:if="{{item.selected}}"></text>
          </view>
        </view>

        <!-- 商品信息 -->
        <view class="item-content">
          <image src="{{item.image}}" class="item-image" bindtap="goToDetail" data-id="{{item.productId}}" mode="aspectFill" />
          
          <view class="item-info">
            <view class="item-header">
              <text class="item-name">{{item.name}}</text>
              <view class="item-price">
                <text class="current-price">¥{{item.price}}</text>
              </view>
            </view>
            
            <!-- 定制化信息 -->
            <view class="customization-info" wx:if="{{item.specDescription}}">
              <text>{{item.specDescription}}</text>
            </view>
            
            <!-- 操作区域 -->
            <view class="item-actions">
              <view class="price-info" wx:if="{{!isEditing}}">
                <text class="subtotal">小计: ¥{{item.subtotal}}</text>
              </view>
              
              <view class="action-buttons" wx:if="{{isEditing}}">
                <button class="btn btn-secondary delete-btn" bindtap="deleteItem" data-id="{{item.cartItemId}}">
                  删除
                </button>
              </view>
              
              <view class="quantity-selector" wx:if="{{!isEditing}}">
                <view class="q-btn" bindtap="decreaseQuantity" data-item="{{item}}">-</view>
                <text class="q-val">{{item.quantity}}</text>
                <view class="q-btn" bindtap="increaseQuantity" data-item="{{item}}">+</view>
              </view>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- 优惠券 -->
    <view class="coupon-section card" wx:if="{{!isEditing}}" bindtap="goToCoupon">
      <view class="section-header">
        <text class="section-title">优惠券</text>
        <view class="coupon-info">
          <text class="available-coupons">{{availableCouponCount}}张可用</text>
          <text class="iconfont icon-right"></text>
        </view>
      </view>
    </view>

    <!-- 备注 -->
    <view class="remark-section card" wx:if="{{!isEditing}}">
      <view class="section-header">
        <text class="section-title">订单备注</text>
      </view>
      <textarea 
        class="remark-input" 
        placeholder="请输入备注信息（口味、偏好等）"
        value="{{remark}}"
        bindinput="onRemarkInput"
        maxlength="100"
      ></textarea>
    </view>
  </view>

  <!-- 底部结算栏 -->
  <view class="bottom-settlement" wx:if="{{cartItems.length > 0}}">
    <view class="settlement-left" wx:if="{{!isEditing}}">
      <view class="total-amount">
        <text class="total-label">合计：</text>
        <text class="total-price">¥{{totalAmount}}</text>
      </view>
    </view>
    
    <view class="settlement-right">
      <button 
        class="btn btn-secondary" 
        bindtap="deleteSelectedItems"
        wx:if="{{isEditing}}"
      >
        删除选中
      </button>
      <button 
        class="btn btn-primary checkout-btn" 
        bindtap="goToCheckout"
        wx:if="{{!isEditing}}"
        disabled="{{selectedCount === 0}}"
      >
        去结算({{selectedCount}})
      </button>
    </view>
  </view>
</view>