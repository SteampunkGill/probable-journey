<view class="register-page">
  <!-- 顶部Logo和标题 -->
  <view class="header">
    <view class="logo-wrapper">
      <image src="/assets/icons/user.png" class="logo" mode="aspectFit" />
    </view>
    <text class="app-name">奶茶小店</text>
    <text class="subtitle">加入我们，开启美味之旅</text>
  </view>

  <!-- 注册卡片 -->
  <view class="register-card">
    <view class="form-content">
      <!-- 注册类型切换 -->
      <view class="type-switch">
        <view 
          class="switch-item {{ registerType === 'user' ? 'active' : '' }}" 
          bindtap="switchType" data-type="user"
        >普通用户注册</view>
        <view 
          class="switch-item {{ registerType === 'admin' ? 'active' : '' }}" 
          bindtap="switchType" data-type="admin"
        >管理员注册</view>
      </view>

      <!-- 用户名输入框 -->
      <view class="form-group">
        <view class="input-label">用户名</view>
        <view class="input-wrapper {{ isFocusUsername ? 'input-focus' : '' }} {{ errors.username ? 'error' : '' }}">
          <text class="iconfont icon-user"></text>
          <input 
            type="text" 
            placeholder="请设置用户名" 
            class="input-field"
            value="{{username}}"
            bindinput="onInput" data-key="username"
            bindfocus="onFocus" data-key="isFocusUsername"
            bindblur="validateUsername"
          />
        </view>
        <view class="error-msg" wx:if="{{errors.username}}">{{ errors.username }}</view>
      </view>

      <!-- 手机号输入框 -->
      <view class="form-group">
        <view class="input-label">手机号</view>
        <view class="input-wrapper {{ isFocusPhone ? 'input-focus' : '' }} {{ errors.phone ? 'error' : '' }}">
          <text class="iconfont icon-phone"></text>
          <input 
            type="number" 
            placeholder="请输入手机号" 
            class="input-field"
            value="{{phone}}"
            bindinput="onInput" data-key="phone"
            bindfocus="onFocus" data-key="isFocusPhone"
            bindblur="validatePhone"
            maxlength="11"
          />
        </view>
        <view class="error-msg" wx:if="{{errors.phone}}">{{ errors.phone }}</view>
      </view>

      <!-- 密码输入框 -->
      <view class="form-group">
        <view class="input-label">登录密码</view>
        <view class="input-wrapper {{ isFocusPassword ? 'input-focus' : '' }} {{ errors.password ? 'error' : '' }}">
          <text class="iconfont icon-lock"></text>
          <input 
            password="{{!showPassword}}" 
            placeholder="请设置6-20位登录密码" 
            class="input-field"
            value="{{password}}"
            bindinput="onInput" data-key="password"
            bindfocus="onFocus" data-key="isFocusPassword"
            bindblur="validatePassword"
          />
          <view class="eye-icon" bindtap="togglePassword">
            <text class="iconfont {{ showPassword ? 'icon-eye-open' : 'icon-eye-close' }}"></text>
          </view>
        </view>
        <view class="error-msg" wx:if="{{errors.password}}">{{ errors.password }}</view>
      </view>

      <!-- 确认密码输入框 -->
      <view class="form-group">
        <view class="input-label">确认密码</view>
        <view class="input-wrapper {{ isFocusConfirmPassword ? 'input-focus' : '' }} {{ errors.confirmPassword ? 'error' : '' }}">
          <text class="iconfont icon-lock"></text>
          <input 
            password="{{!showConfirmPassword}}" 
            placeholder="请再次输入密码" 
            class="input-field"
            value="{{confirmPassword}}"
            bindinput="onInput" data-key="confirmPassword"
            bindfocus="onFocus" data-key="isFocusConfirmPassword"
            bindblur="validateConfirmPassword"
          />
          <view class="eye-icon" bindtap="toggleConfirmPassword">
            <text class="iconfont {{ showConfirmPassword ? 'icon-eye-open' : 'icon-eye-close' }}"></text>
          </view>
        </view>
        <view class="error-msg" wx:if="{{errors.confirmPassword}}">{{ errors.confirmPassword }}</view>
      </view>

      <!-- 管理员密令输入框 (仅管理员注册显示) -->
      <view class="form-group" wx:if="{{registerType === 'admin'}}">
        <view class="input-label">管理员注册密令</view>
        <view class="input-wrapper {{ isFocusSecret ? 'input-focus' : '' }} {{ errors.secret ? 'error' : '' }}">
          <text class="iconfont icon-lock"></text>
          <input 
            password 
            placeholder="请输入管理员注册密令" 
            class="input-field"
            value="{{secret}}"
            bindinput="onInput" data-key="secret"
            bindfocus="onFocus" data-key="isFocusSecret"
            bindblur="onBlurSecret"
          />
        </view>
        <view class="error-msg" wx:if="{{errors.secret}}">{{ errors.secret }}</view>
      </view>

      <!-- 注册按钮 -->
      <button 
        class="register-btn {{ registerType === 'admin' ? 'admin-btn' : '' }}" 
        bindtap="handleRegister"
        disabled="{{loading || !agreed}}"
      >
        {{ loading ? '注册中...' : (registerType === 'admin' ? '注册管理员' : '立即注册') }}
      </button>

      <!-- 返回登录 -->
      <view class="bottom-actions">
        <text class="no-account">已有账号？</text>
        <text class="action-text login-link" bindtap="goToLogin">去登录</text>
      </view>
    </view>
  </view>

  <!-- 协议区域 -->
  <view class="agreement-section">
    <checkbox-group bindchange="onAgreementChange">
      <checkbox value="agreed" checked="{{agreed}}" color="var(--primary-color)" />
    </checkbox-group>
    <view class="agreement-text">
      我已阅读并同意<text class="agreement-link" bindtap="goToAgreement" data-type="user">《用户协议》</text>和<text class="agreement-link" bindtap="goToAgreement" data-type="privacy">《隐私政策》</text>
    </view>
  </view>
</view>