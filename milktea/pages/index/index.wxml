<view class="page-container">
  <!-- 顶部搜索栏 -->
  <view class="search-bar {{scrollTop > 50 ? 'shadow' : ''}}">
    <view class="search-box" bindtap="goToSearch">
      <image class="search-icon" src="/assets/images/icons/search.png" />
      <text class="search-placeholder">搜索饮品、门店...</text>
    </view>
    <image class="scan-btn" src="/assets/images/icons/scan.png" bindtap="onScan" />
  </view>

  <!-- 骨架屏加载 -->
  <view class="skeleton-container" wx:if="{{loading}}">
    <view class="skeleton-banner"></view>
    <view class="skeleton-mode">
      <view class="skeleton-mode-item"></view>
      <view class="skeleton-mode-item"></view>
    </view>
    <view class="skeleton-menu">
      <view class="skeleton-menu-item" wx:for="{{4}}" wx:key="*this"></view>
    </view>
  </view>

  <scroll-view 
    class="main-content" 
    scroll-y 
    bindscroll="onScroll" 
    wx:else
  >
    <!-- 通知栏 -->
    <view class="notification-bar" wx:if="{{showNotification && currentNotification}}">
      <view class="notification-content">
        <image class="notice-icon" src="/assets/images/icons/info.png" />
        <text class="notice-text">{{currentNotification.title}}: {{currentNotification.content}}</text>
      </view>
      <image class="close-icon" src="/assets/images/icons/history.png" bindtap="closeNotification" />
    </view>

    <!-- 轮播图 -->
    <view class="banner-container" wx:if="{{banners.length > 0}}">
      <swiper 
        class="banner-swiper" 
        circular 
        autoplay 
        interval="5000" 
        indicator-dots 
        indicator-active-color="#a0522d"
      >
        <swiper-item wx:for="{{banners}}" wx:key="id" bindtap="onBannerClick" data-item="{{item}}">
          <image src="{{item.imageUrl}}" class="banner-image" mode="aspectFill" />
        </swiper-item>
      </swiper>
    </view>
    <view class="banner-placeholder" wx:else></view>

    <!-- 门店选择组件 -->
    <view class="store-selector-section">
      <view class="current-store" bindtap="goToSelectStore">
        <view class="store-main">
          <image class="location-icon" src="/assets/images/icons/address.png" />
          <view class="store-info-content">
            <view class="store-name-wrapper">
              <text class="store-name">{{selectedStore.name || '正在定位...'}}</text>
              <text class="store-distance" wx:if="{{selectedStore.distance}}">距您 {{selectedStore.distance}}km</text>
            </view>
            <view class="store-address-text">{{selectedStore.address || '请选择门店'}}</view>
          </view>
          <image class="arrow-icon" src="/assets/images/icons/right.png" />
        </view>
      </view>
      <view class="location-action" bindtap="reLocation">
        <image class="re-location-icon {{isLocating ? 'rotating' : ''}}" src="/assets/images/icons/history.png" />
        <text>重新定位</text>
      </view>
    </view>

    <!-- 点餐方式选择 -->
    <view class="order-mode-section">
      <view class="mode-title">选择点餐方式</view>
      <view class="mode-buttons">
        <view class="mode-card delivery" bindtap="selectOrderMode" data-mode="delivery">
          <image class="mode-icon" src="/assets/images/icons/order.png" />
          <view class="mode-info">
            <text class="mode-name">外卖配送</text>
            <text class="mode-desc">30分钟送达</text>
          </view>
        </view>
        
        <view class="mode-card pickup" bindtap="selectOrderMode" data-mode="pickup">
          <image class="mode-icon" src="/assets/images/icons/pick_up_food.png" />
          <view class="mode-info">
            <text class="mode-name">到店自取</text>
            <text class="mode-desc">预计制作时间</text>
          </view>
        </view>
      </view>
    </view>

    <!-- 快捷入口 -->
    <view class="quick-menu">
      <view class="menu-item" bindtap="goToOrder">
        <view class="menu-icon-wrapper">
          <image class="menu-icon" src="/assets/images/icons/order.png" />
        </view>
        <text class="menu-name">点单</text>
      </view>
      <view class="menu-item" bindtap="goToCoupon">
        <view class="menu-icon-wrapper">
          <image class="menu-icon" src="/assets/images/icons/coupon.png" />
          <view class="coupon-badge" wx:if="{{availableCouponCount > 0}}">{{availableCouponCount}}</view>
        </view>
        <text class="menu-name">优惠券</text>
      </view>
      <view class="menu-item" bindtap="goToWallet">
        <view class="menu-icon-wrapper">
          <image class="menu-icon" src="/assets/images/icons/gift.png" />
        </view>
        <text class="menu-name">钱包</text>
      </view>
      <view class="menu-item" bindtap="goToShare">
        <view class="menu-icon-wrapper">
          <image class="menu-icon" src="/assets/images/icons/gift.png" />
        </view>
        <text class="menu-name">分享有礼</text>
      </view>
    </view>

    <!-- 推荐商品 -->
    <view class="section" wx:if="{{recommendProducts.length > 0}}">
      <view class="section-header">
        <text class="section-title">为你推荐</text>
        <view class="section-more" bindtap="goToOrder">
          <text>更多</text>
          <image class="arrow-icon" src="/assets/images/icons/right.png" />
        </view>
      </view>
      
      <scroll-view class="recommend-scroll" scroll-x>
        <view class="recommend-list">
          <view 
            class="recommend-item" 
            wx:for="{{recommendProducts}}" 
            wx:key="id"
            bindtap="goToProductDetail"
            data-id="{{item.id}}"
          >
            <image src="{{item.image}}" class="recommend-image" mode="aspectFill" />
            <view class="recommend-info">
              <text class="recommend-name">{{item.name}}</text>
              <view class="recommend-bottom">
                <text class="recommend-price">¥{{item.price}}</text>
                <image class="add-icon" src="/assets/images/icons/add.png" catchtap="quickAdd" data-item="{{item}}" />
              </view>
            </view>
          </view>
        </view>
      </scroll-view>
    </view>

    <!-- 今日热门 -->
    <view class="section" wx:if="{{hotProducts.length > 0}}">
      <view class="section-header">
        <text class="section-title">今日热门</text>
        <view class="section-more" bindtap="goToOrder">
          <text>更多</text>
          <image class="arrow-icon" src="/assets/images/icons/right.png" />
        </view>
      </view>
      
      <view class="hot-list">
        <view 
          class="hot-item" 
          wx:for="{{hotProducts}}" 
          wx:key="id"
          bindtap="goToProductDetail"
          data-id="{{item.id}}"
        >
          <image src="{{item.image}}" class="hot-image" mode="aspectFill" />
          <view class="hot-info">
            <text class="hot-name">{{item.name}}</text>
            <text class="hot-desc">{{item.description}}</text>
            <view class="hot-bottom">
              <view class="hot-meta">
                <text class="hot-price">¥{{item.price}}</text>
                <text class="hot-sales">已售{{item.sales}}</text>
              </view>
              <image class="add-icon" src="/assets/images/icons/add.png" catchtap="quickAdd" data-item="{{item}}" />
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- 附近门店 -->
    <view class="section" wx:if="{{selectedStore}}">
      <view class="section-header">
        <text class="section-title">附近门店</text>
        <view class="section-more" bindtap="goToSelectStore">
          <text>更多</text>
          <image class="arrow-icon" src="/assets/images/icons/right.png" />
        </view>
      </view>
      
      <view class="store-card" bindtap="goToSelectStore">
        <view class="store-header">
          <text class="store-name">{{selectedStore.name}}</text>
          <view class="store-status {{selectedStore.status === 'OPEN' ? 'open' : 'closed'}}">
            {{selectedStore.status === 'OPEN' ? '营业中' : '休息中'}}
          </view>
        </view>
        <view class="store-info">
          <image class="info-icon" src="/assets/images/icons/address.png" />
          <text class="store-address">{{selectedStore.address}}</text>
        </view>
        <view class="store-info">
          <image class="info-icon" src="/assets/images/icons/info.png" />
          <text class="store-hours">{{selectedStore.businessHours || '09:00-22:00'}}</text>
        </view>
        <view class="store-footer">
          <text class="store-distance" wx:if="{{selectedStore.distance}}">距您 {{selectedStore.distance}}km</text>
          <view class="store-call" catchtap="makePhoneCall" data-phone="{{selectedStore.phone}}">
            <image class="call-icon" src="/assets/images/icons/phone.png" />
            <text>联系门店</text>
          </view>
        </view>
      </view>
    </view>
  </scroll-view>
  
  <!-- 购物车浮动按钮 -->
  <view class="cart-float {{cartCount > 0 ? 'show' : ''}}" bindtap="goToCart">
    <image class="cart-icon" src="/assets/images/icons/cart.png" />
    <view class="cart-badge {{cartAnimating ? 'bounce' : ''}}">{{cartCount}}</view>
  </view>
</view>