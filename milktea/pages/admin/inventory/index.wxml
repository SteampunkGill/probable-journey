<view class="inventory-manage">
  <view class="page-header card">
    <text class="title">库存与成本管理</text>
  </view>

  <view class="table-container card">
    <view class="table-header">
      <text class="th">原料名称</text>
      <text class="th">当前库存</text>
      <text class="th">状态</text>
      <text class="th">操作</text>
    </view>
    <view class="table-body">
      <view class="tr" wx:for="{{inventory}}" wx:key="id">
        <view class="td name-col">
          <text class="name">{{item.name}}</text>
          <text class="unit">/ {{item.unit}}</text>
        </view>
        <view class="td stock-col {{item.isLowStock ? 'text-danger' : ''}}">
          {{item.stock}}
        </view>
        <view class="td status-col">
          <text class="badge {{item.isLowStock ? 'badge-warn' : 'badge-success'}}">
            {{item.isLowStock ? '库存不足' : '正常'}}
          </text>
        </view>
        <view class="td ops-col">
          <button class="op-btn" bindtap="showUpdateModal" data-item="{{item}}" data-type="stock">更新</button>
          <button class="op-btn" bindtap="showUpdateModal" data-item="{{item}}" data-type="cost">成本</button>
          <button class="op-btn" bindtap="showUpdateModal" data-item="{{item}}" data-type="alert">预警</button>
        </view>
      </view>
    </view>
  </view>

  <!-- 更新弹窗 -->
  <view wx:if="{{modal.show}}" class="modal-mask">
    <view class="modal-container">
      <view class="modal-header">
        <text class="modal-title">{{modalTitle}} - {{modal.item.name}}</text>
      </view>
      <view class="modal-body">
        <view class="form-item">
          <text class="form-label">{{modalLabel}}：</text>
          <input value="{{modal.value}}" type="digit" bindinput="onModalValueInput" class="admin-input" />
        </view>
        <view wx:if="{{modal.type === 'cost'}}" class="cost-tip">
          <text>温馨提示：调整原料成本后，系统将自动重新计算所有关联奶茶产品的成本价。</text>
        </view>
      </view>
      <view class="modal-footer">
        <button class="cancel-btn" bindtap="hideModal">取消</button>
        <button class="confirm-btn" bindtap="handleUpdate">确认更新</button>
      </view>
    </view>
  </view>
</view>