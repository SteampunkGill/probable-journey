<view class="dashboard-container">
  <!-- 今日关键指标 -->
  <view class="metrics-grid">
    <view class="metric-card" wx:for="{{metricsConfig}}" wx:for-index="key" wx:for-item="val" wx:key="key">
      <view class="metric-header">
        <text class="metric-label">{{val.label}}</text>
        <text class="metric-unit">{{val.unit}}</text>
      </view>
      <view class="metric-value">{{metrics[key] || 0}}</view>
      <view class="metric-footer">
        <text class="compare-label">较昨日</text>
        <text class="compare-value {{metrics.comparedToYesterday[key] && metrics.comparedToYesterday[key][0] === '+' ? 'up' : 'down'}}">
          {{metrics.comparedToYesterday[key] || '0%'}}
        </text>
      </view>
    </view>
  </view>

  <view class="charts-row">
    <!-- 实时销售趋势 -->
    <view class="chart-card card">
      <view class="card-header">实时销售趋势 (最近8小时)</view>
      <view class="bar-chart">
        <view wx:for="{{realtimeSales.salesData}}" wx:key="index" class="bar-item">
          <view class="bar-wrapper">
            <view class="bar" style="height: {{(item / maxSales * 100 || 0)}}%">
              <view class="bar-tooltip">¥{{item}}</view>
            </view>
          </view>
          <view class="bar-label">{{realtimeSales.timeLabels[index]}}</view>
        </view>
      </view>
    </view>

    <!-- 销售趋势分析 -->
    <view class="chart-card card">
      <view class="card-header">近7日销售趋势</view>
      <view class="line-chart-placeholder">
        <view wx:for="{{salesTrend.sales}}" wx:key="index" class="line-point" style="left: {{(index * 15)}}%; bottom: {{(item / maxTrendSales * 100 || 0)}}%">
          <view class="point"></view>
          <view class="point-label">{{salesTrend.dates[index]}}</view>
        </view>
      </view>
    </view>
  </view>

  <view class="bottom-row">
    <!-- 商品销售排行 -->
    <view class="ranking-card card">
      <view class="card-header">商品销售排行 (本月)</view>
      <view class="ranking-list">
        <view wx:for="{{productRanking}}" wx:key="productId" class="ranking-item">
          <view class="rank-info">
            <text class="rank-index {{index < 3 ? 'top3' : ''}}">{{index + 1}}</text>
            <text class="rank-name">{{item.productName}}</text>
          </view>
          <view class="rank-data">
            <text class="rank-count">{{item.salesCount}} 杯</text>
            <text class="rank-amount">¥{{item.salesAmount}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- 预警系统 -->
    <view class="alert-card card">
      <view class="card-header">系统预警</view>
      <view class="alert-list">
        <view wx:if="{{inventoryAlerts.length === 0 && orderAlerts.length === 0}}" class="empty-alert">
          暂无预警信息
        </view>
        <view wx:for="{{inventoryAlerts}}" wx:key="productId" class="alert-item warning">
          <text class="iconfont icon-inventory"></text>
          <view class="alert-content">
            <view class="alert-title">库存预警</view>
            <view class="alert-desc">{{item.productName}}({{item.specName}}) 当前库存 {{item.currentStock}}，低于阈值 {{item.threshold}}</view>
          </view>
        </view>
        <view wx:for="{{orderAlerts}}" wx:key="orderId" class="alert-item danger">
          <text class="iconfont icon-order"></text>
          <view class="alert-content">
            <view class="alert-title">异常订单</view>
            <view class="alert-desc">订单 {{item.orderNo}} 制作超时，请尽快处理</view>
          </view>
        </view>
      </view>
    </view>
  </view>
</view>