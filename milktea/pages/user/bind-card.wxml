<view class="bind-card-page">
  <view class="content">
    <!-- 已绑定卡片展示 -->
    <view class="card-preview" wx:if="{{hasCard}}">
      <view class="card-bg bound">
        <view class="card-info">
          <text class="brand">奶茶小店</text>
          <text class="card-type">尊享会员卡</text>
        </view>
        <view class="card-number">
          {{ formattedCurrentCardNumber }}
        </view>
        <view class="card-status">已激活</view>
      </view>
      <button class="unbind-btn" bindtap="handleUnbind" disabled="{{loading}}">
        {{ loading ? '处理中...' : '解除绑定' }}
      </button>
    </view>

    <!-- 未绑定状态：选择操作 -->
    <view wx:else>
      <view class="tab-header">
        <view 
          class="tab-item {{ activeTab === 'bind' ? 'active' : '' }}" 
          bindtap="switchTab"
          data-tab="bind"
        >绑定已有卡</view>
        <view 
          class="tab-item {{ activeTab === 'apply' ? 'active' : '' }}" 
          bindtap="switchTab"
          data-tab="apply"
        >申请电子卡</view>
      </view>

      <!-- 绑定已有卡表单 -->
      <view class="form-container" wx:if="{{activeTab === 'bind'}}">
        <view class="card-preview">
          <view class="card-bg">
            <view class="card-info">
              <text class="brand">奶茶小店</text>
              <text class="card-type">实体卡绑定</text>
            </view>
            <view class="card-number" wx:if="{{cardNumber}}">
              {{ formattedCardNumber }}
            </view>
            <view class="card-number-placeholder" wx:else>
              **** **** **** ****
            </view>
          </view>
        </view>

        <view class="bind-form">
          <view class="form-item">
            <label>卡号</label>
            <input
              type="text"
              value="{{cardNumber}}"
              placeholder="请输入会员卡号"
              maxlength="20"
              bindinput="onCardNumberInput"
            />
          </view>
          <view class="form-item">
            <label>激活码</label>
            <input 
              type="password" 
              value="{{activeCode}}" 
              placeholder="请输入卡片背面的激活码" 
              maxlength="6"
              bindinput="onActiveCodeInput"
            />
          </view>
        </view>

        <button 
          class="action-btn" 
          disabled="{{!isBindReady || loading}}"
          bindtap="handleBind"
        >
          {{ loading ? '正在绑定...' : '立即绑定' }}
        </button>
      </view>

      <!-- 申请电子卡表单 -->
      <view class="form-container" wx:else>
        <view class="card-preview">
          <view class="card-bg apply">
            <view class="card-info">
              <text class="brand">奶茶小店</text>
              <text class="card-type">电子会员卡</text>
            </view>
            <view class="card-number-placeholder">
              申请后自动生成卡号
            </view>
          </view>
        </view>

        <view class="bind-form">
          <view class="form-item">
            <label>姓名</label>
            <input 
              type="text" 
              value="{{applyForm.name}}" 
              placeholder="请输入真实姓名" 
              bindinput="onNameInput"
            />
          </view>
          <view class="form-item">
            <label>手机号</label>
            <input 
              type="number" 
              value="{{applyForm.phone}}" 
              placeholder="请输入手机号" 
              maxlength="11"
              bindinput="onPhoneInput"
            />
          </view>
          <view class="form-item">
            <label>生日</label>
            <picker mode="date" value="{{applyForm.birthday}}" bindchange="onBirthdayChange">
              <view class="picker-value {{ !applyForm.birthday ? 'placeholder' : '' }}">
                {{ applyForm.birthday || '请选择生日' }}
              </view>
            </picker>
          </view>
        </view>

        <button 
          class="action-btn" 
          disabled="{{!isApplyReady || loading}}"
          bindtap="handleApply"
        >
          {{ loading ? '正在申请...' : '立即申请' }}
        </button>
      </view>
    </view>

    <view class="tips">
      <view class="tips-title">温馨提示：</view>
      <view>1. 电子会员卡申请成功后立即生效。</view>
      <view>2. 绑定实体卡可同步线下消费积分。</view>
      <view>3. 如有疑问请联系在线客服。</view>
    </view>
  </view>
</view>