<view class="points-page">
  <!-- ç§¯åˆ†å¡ç‰‡ -->
  <view class="points-card">
    <view class="card-bg"></view>
    <view class="card-content">
      <view class="points-info">
        <text class="points-label">æˆ‘çš„ç§¯åˆ†</text>
        <view class="points-value">{{ userPoints }}</view>
      </view>
      <view class="card-actions">
        <view class="action-btn" bindtap="toggleRecords">
          <text class="action-icon">ğŸ“œ</text>
          <text>å…‘æ¢è®°å½•</text>
        </view>
        <view class="action-btn" bindtap="goToRules">
          <text class="action-icon">â„¹ï¸</text>
          <text>ç§¯åˆ†è§„åˆ™</text>
        </view>
      </view>
    </view>
  </view>

  <!-- åˆ†ç±»æ ‡ç­¾ -->
  <view class="category-tabs">
    <view 
      class="tab-item {{ activeCategoryId === item.id ? 'active' : '' }}"
      wx:for="{{categories}}"
      wx:key="id"
      bindtap="selectCategory"
      data-id="{{item.id}}"
    >
      {{ item.name }}
    </view>
  </view>

  <!-- å•†å“åˆ—è¡¨ -->
  <view class="product-list">
    <view 
      class="product-item"
      wx:for="{{productList}}"
      wx:key="id"
    >
      <image class="product-image" src="{{ item.image || item.imageUrl || '/assets/images/icons/user.png' }}" mode="aspectFill" />
      <view class="product-info">
        <view class="product-name">{{ item.name }}</view>
        <view class="product-desc">{{ item.description || item.desc }}</view>
        <view class="product-footer">
          <view class="points-price">
            <text class="points-num">{{ item.points || item.pointCost }}</text>
            <text class="points-unit">ç§¯åˆ†</text>
          </view>
          <button 
            class="exchange-btn" 
            bindtap="exchangeProduct" 
            data-product="{{item}}"
            disabled="{{userPoints < (item.points || item.pointCost) || item.stock <= 0}}"
          >
            {{ item.stock > 0 ? 'ç«‹å³å…‘æ¢' : 'å·²å…‘å®Œ' }}
          </button>
        </view>
        <view class="stock-info" wx:if="{{item.stock <= 10 && item.stock > 0}}">
          <text>ä»…å‰©{{ item.stock }}ä»¶</text>
        </view>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-tip" wx:if="{{productList.length === 0 && !loading}}">
    <view class="empty-icon">ğŸ</view>
    <view>æš‚æ— å¯å…‘æ¢å•†å“</view>
  </view>

  <!-- å…‘æ¢è®°å½•å¼¹çª— -->
  <view class="records-modal" wx:if="{{showRecords}}">
    <view class="modal-mask" bindtap="toggleRecords"></view>
    <view class="modal-content">
      <view class="modal-header">
        <view class="modal-title">å…‘æ¢è®°å½•</view>
        <view class="close-icon" bindtap="toggleRecords">âœ•</view>
      </view>
      <scroll-view class="modal-body" scroll-y>
        <view class="empty-records" wx:if="{{exchangeRecords.length === 0}}">
          <view class="empty-icon">ğŸ“œ</view>
          <view>æš‚æ— å…‘æ¢è®°å½•</view>
        </view>
        <view class="record-list" wx:else>
          <view class="record-item" wx:for="{{exchangeRecords}}" wx:key="id">
            <view class="record-info">
              <view class="record-name">{{item.productName}}</view>
              <view class="record-time">{{item.createTime}}</view>
            </view>
            <view class="record-points">-{{item.points}}ç§¯åˆ†</view>
          </view>
        </view>
      </scroll-view>
    </view>
  </view>
</view>