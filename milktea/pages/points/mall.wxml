<view class="points-mall-page">
  <!-- å¤´éƒ¨ -->
  <view class="mall-header">
    <view class="header-top">
      <view class="header-left">
        <text class="header-title">ç§¯åˆ†å•†åŸ</text>
      </view>
      <view class="header-right">
        <text class="iconfont icon-history" bindtap="viewExchangeRecords">ğŸ“œ</text>
        <text class="iconfont icon-info" bindtap="howToGetPoints">â“</text>
      </view>
    </view>
    
    <!-- ç§¯åˆ†ä¿¡æ¯ -->
    <view class="points-info-card">
      <view class="points-main">
        <view class="points-left">
          <text class="points-label">å½“å‰ç§¯åˆ†</text>
          <view class="points-value">
            <text class="points-number">{{ points }}</text>
            <text class="points-unit">ç§¯åˆ†</text>
          </view>
        </view>
        <view class="points-right">
          <text class="exchange-label">å¯å…‘æ¢å•†å“</text>
        </view>
      </view>
      
      <view class="points-actions">
        <view class="action-item" bindtap="signIn">
          <text class="action-label">ä»Šæ—¥ç­¾åˆ°</text>
          <view class="action-icon">
            <text class="iconfont icon-check">âœ…</text>
          </view>
        </view>
        <view class="action-item" bindtap="viewTasks">
          <text class="action-label">ç§¯åˆ†ä»»åŠ¡</text>
          <view class="action-icon">
            <text class="iconfont icon-gift">ğŸ</text>
          </view>
        </view>
        <view class="action-item" bindtap="viewExchangeRecords">
          <text class="action-label">å…‘æ¢è®°å½•</text>
          <view class="action-icon">
            <text class="iconfont icon-list">ğŸ“‹</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- æœç´¢æ¡† -->
  <view class="search-section">
    <view class="search-box">
      <text class="iconfont icon-search">ğŸ”</text>
      <input 
        value="{{searchKeyword}}"
        placeholder="æœç´¢ç§¯åˆ†å•†å“"
        bindinput="onSearchInput"
      />
    </view>
  </view>

  <!-- åˆ†ç±»æ ‡ç­¾ -->
  <view class="categories-section">
    <scroll-view class="categories-scroll" scroll-x enable-flex>
      <view 
        wx:for="{{categories}}"
        wx:key="id"
        class="category-item {{ item.active ? 'active' : '' }}"
        bindtap="selectCategory"
        data-index="{{index}}"
      >
        {{ item.name }}
      </view>
    </scroll-view>
  </view>

  <!-- æ’åºé€‰é¡¹ -->
  <view class="sort-section">
    <view class="sort-options">
      <view 
        wx:for="{{sortOptions}}"
        wx:key="id"
        class="sort-item {{ item.active ? 'active' : '' }}"
        bindtap="selectSort"
        data-index="{{index}}"
      >
        {{ item.name }}
      </view>
    </view>
  </view>

  <!-- å•†å“åˆ—è¡¨ -->
  <view class="products-section">
    <view wx:if="{{loading}}" class="loading-state">
      <view class="loading-icon"></view>
      <text>åŠ è½½ä¸­...</text>
    </view>
    
    <view wx:else class="products-grid">
      <view 
        wx:for="{{filteredProducts}}"
        wx:key="id"
        class="product-card"
        bindtap="viewProductDetail"
        data-id="{{item.id}}"
      >
        <!-- çƒ­é—¨æ ‡ç­¾ -->
        <view wx:if="{{item.hot}}" class="hot-tag">
          <text class="iconfont icon-fire">ğŸ”¥</text>
          <text>çƒ­é—¨</text>
        </view>
        
        <!-- å•†å“å›¾ç‰‡ -->
        <view class="product-image">
          <image src="{{ item.image || item.imageUrl || '/assets/images/icons/user.png' }}" mode="aspectFill" />
        </view>
        
        <!-- å•†å“ä¿¡æ¯ -->
        <view class="product-info">
          <view class="product-name">{{ item.name }}</view>
          <view class="product-desc">{{ item.description || item.desc }}</view>
          
          <!-- ç§¯åˆ†ä¿¡æ¯ -->
          <view class="product-points">
            <view class="points-display">
              <text class="current-points">{{ item.points || item.pointCost }}</text>
              <text class="points-unit">ç§¯åˆ†</text>
              <text wx:if="{{item.originalPoints > (item.points || item.pointCost)}}" class="original-points">
                {{ item.originalPoints }}ç§¯åˆ†
              </text>
            </view>
            
            <!-- åº“å­˜ä¿¡æ¯ -->
            <view class="stock-info">
              <text>åº“å­˜: {{ item.stock }}ä»¶</text>
              <text class="limit-info">{{ item.limitInfo || item.limit || '' }}</text>
            </view>
          </view>
          
          <!-- å…‘æ¢æŒ‰é’® -->
          <button class="exchange-btn" catchtap="exchangeProduct" data-product="{{item}}">
            ç«‹å³å…‘æ¢
          </button>
        </view>
      </view>
    </view>
    
    <!-- ç©ºçŠ¶æ€ -->
    <view wx:if="{{!loading && filteredProducts.length === 0}}" class="empty-state">
      <text class="iconfont icon-gift">ğŸ</text>
      <view class="empty-text">æš‚æ— å•†å“</view>
      <view class="empty-hint">æ¢ä¸ªåˆ†ç±»è¯•è¯•å§~</view>
    </view>
  </view>

  <!-- åº•éƒ¨æç¤º -->
  <view class="footer-hint">
    <text>ç§¯åˆ†å…‘æ¢è§„åˆ™ï¼šå…‘æ¢æˆåŠŸåä¸å¯é€€æ¬¾ï¼Œä¼˜æƒ åˆ¸ç±»å•†å“è¯·åœ¨æœ‰æ•ˆæœŸå†…ä½¿ç”¨</text>
  </view>
</view>