<view class="coupon-selector">
  <!-- 选择按钮 -->
  <view class="selector-trigger" bindtap="showSelector">
    <view class="default-trigger {{selectedCoupon ? 'has-value' : ''}}">
      <view class="trigger-content">
        <text class="trigger-text">
          {{selectedCoupon ? selectedCoupon.name : placeholder}}
        </text>
        <text class="trigger-desc" wx:if="{{selectedCoupon}}">
          优惠{{selectedCoupon.value}}元
        </text>
      </view>
      <text class="icon-right">></text>
    </view>
  </view>

  <!-- 优惠券选择弹窗 -->
  <view class="coupon-modal" wx:if="{{showModal}}">
    <view class="modal-mask" bindtap="hideSelector"></view>
    
    <view class="modal-content">
      <!-- 头部 -->
      <view class="modal-header">
        <text class="modal-title">选择优惠券</text>
        <view class="icon-close" bindtap="hideSelector">×</view>
      </view>

      <!-- 优惠券列表 -->
      <scroll-view scroll-y class="coupon-list">
        <view 
          class="coupon-item {{selectedCouponId === item.id ? 'selected' : ''}} {{!item.isUsable ? 'disabled' : ''}}" 
          wx:for="{{filteredCoupons}}" 
          wx:key="id"
          bindtap="selectCoupon"
          data-coupon="{{item}}"
        >
          <!-- 左侧优惠信息 -->
          <view class="coupon-left">
            <view class="coupon-value">
              <text class="value-symbol" wx:if="{{item.value >= 1}}">¥</text>
              <text class="value-number">{{item.value}}</text>
              <text class="value-unit" wx:if="{{item.value < 1}}">折</text>
            </view>
            <view class="coupon-conditions">
              <text class="condition-text">{{item.minAmount > 0 ? '满' + item.minAmount + '元可用' : '无门槛'}}</text>
            </view>
          </view>

          <!-- 右侧详细信息 -->
          <view class="coupon-right">
            <view class="coupon-info">
              <text class="coupon-name">{{item.name}}</text>
              <text class="coupon-desc">{{item.description}}</text>
              <view class="coupon-validity">
                <text class="validity-text">{{item.expireAt || '长期有效'}}</text>
              </view>
            </view>
            
            <!-- 选择状态 -->
            <view class="coupon-status">
              <view class="status-indicator" wx:if="{{selectedCouponId === item.id}}">✓</view>
              <view class="status-text" wx:else>
                <text>{{!item.isUsable ? '不可用' : '点击使用'}}</text>
              </view>
            </view>
          </view>
        </view>

        <!-- 空状态 -->
        <view class="empty-coupons" wx:if="{{filteredCoupons.length === 0}}">
          <text class="empty-text">暂无可用优惠券</text>
        </view>
      </scroll-view>

      <!-- 底部操作 -->
      <view class="modal-footer">
        <button class="btn btn-primary" bindtap="confirmSelection" disabled="{{!selectedCouponId}}">
          确定
        </button>
      </view>
    </view>
  </view>
</view>