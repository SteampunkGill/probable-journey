# milktea 微信小程序收尾阶段计划书

## 0. 接口与组件深度审计报告 (New)

### 表格 1：组件与文件迁移对照表
| Vue 组件 (src/views/ 或 src/components/) | 小程序路径 (milktea/) | 状态 | 子依赖/关联检查 |
| :--- | :--- | :--- | :--- |
| `components/AddressPicker.vue` | `components/address-picker` | [x] 已完成 | 依赖 `commonApi.getRegions` |
| `components/CouponSelector.vue` | `components/coupon-selector` | [x] 已完成 | 依赖 `couponApi.getMyCoupons` |
| `components/ProductCard.vue` | `components/product-card` | [x] 已完成 | 样式已对齐 |
| `components/QuantitySelector.vue` | `components/quantity-selector` | [x] 已完成 | 逻辑已同步 |
| `components/RegionPicker.vue` | `components/region-picker` | [x] 已完成 | 依赖 `commonApi.getRegions` |
| `views/index/index.vue` | `pages/index/index` | [x] 已完成 | 包含 Banner, Category, Recommend |
| `views/cart/index.vue` | `pages/cart/index` | [x] 已完成 | 包含结算逻辑 |
| `views/order/checkout.vue` | `pages/order/checkout` | [x] 已完成 | 包含地址选择、优惠券匹配 |
| `views/product/detail.vue` | `pages/product/detail` | [x] 已完成 | 包含规格选择与价格计算 |
| `views/search/search.vue` | `pages/search/search` | [x] 已完成 | 包含历史记录与热词 |
| `views/order/detail.vue` | `pages/order/detail` | [x] 已完成 | 订单详情展示 |
| `views/payment/payment.vue` | `pages/payment/payment` | [x] 已完成 | 支付状态轮询 |
| `views/share/share.vue` | `pages/share/share` | [x] 已完成 | 分享海报生成逻辑 |
| `views/profile/profile.vue` | `pages/user/profile` | [x] 已完成 | 个人资料编辑 |
| `views/settings/about.vue` | `pages/settings/about` | [x] 已完成 | 关于我们内容展示 |
| `views/points/mall/mall.vue` | `pages/points/mall` | [x] 已完成 | 积分商品列表 |
| `views/points/points.vue` | `pages/points/points` | [x] 已完成 | 积分明细记录 |
| `views/wallet/wallet.vue` | `pages/wallet/wallet` | [x] 已完成 | 余额与充值入口 |
| `views/wallet/gift-card.vue` | `pages/wallet/gift-card` | [x] 已完成 | 礼品卡激活与购买 |
| `views/user/bind-card.vue` | `pages/user/bind-card` | [x] 已完成 | 实体卡绑定逻辑 |
| `views/favorite/favorite.vue` | `pages/favorite/favorite` | [x] 已完成 | 收藏列表管理 |
| `views/review/review.vue` | `pages/review/review` | [x] 已完成 | 评价提交逻辑 |

### 表格 2：API 接口一致性对照表
| 检查项 | Vue (axios) | 小程序 (wx.request) | 结论 |
| :--- | :--- | :--- | :--- |
| **BaseURL** | `/api/v1/app` | `http://localhost:8080/api/v1/app` | 一致 |
| **Timeout** | 10000ms | 未显式设置 | **需补齐 (10s)** |
| **Header** | `Authorization`, `token` | `Authorization`, `token` | 一致 |
| **请求拦截** | 路径重写 (/api/common等) | 路径重写逻辑已实现 | 一致 |
| **响应拦截** | 业务码 1001-1004 映射 | 业务码映射已实现 | 一致 |
| **401 处理** | 跳转 `/login` | `reLaunch` 至 `/pages/login/login` | 一致 |

#### 缺失接口清单 (需从 Vue 1:1 搬迁至小程序 api.js)
1.  **Auth**: `logout` (本地), `verifyDeactivation`
2.  **Home**: `submitRecommendationFeedback`
3.  **Product**: `advancedFilter`
4.  **Order**: `getOrderProgressVisual`, `getRefundStatus`, `getOrderStatus`, `getEstimatedTime`, `getOrderStatistics`, `getStatusCount`, `updateOrderRemark`, `submitAppeal`, `buyNow`
5.  **Address**: `getAddressHistory`
6.  **Coupon**: `getCouponDetail`
7.  **Points**: `getExchangeRecords`, `exchangeCoupon`
8.  **Member**: `unbindCard`, `getExclusivePrices`, `getBirthdayPrivilege`, `receiveBirthdayPrivilege`
9.  **Common**: `uploadFile` (需修复 request.js 导出)

---

## 第一阶段：审计与补齐 (Audit & Completion) [100%]
- [x] 订单详情页 (OrderDetail) -> 订单模块 (`pages/order/detail`)
- [x] 支付页面 (Payment) -> 支付模块 (`pages/payment/payment`)
- [x] 分享有礼页面 (Share) -> 营销模块 (`pages/share/share`)
- [x] 个人资料页面 (Profile) -> 用户模块 (`pages/user/profile`)
- [x] 关于我们页面 (About) -> 设置模块 (`pages/settings/about`)
- [x] 积分商城页面 (PointsMall) -> 积分模块 (`pages/points/mall`)
- [x] 积分记录页面 (PointsHistory) -> 积分模块 (`pages/points/points`)
- [x] 钱包页面 (Wallet) -> 用户模块 (`pages/wallet/wallet`)
- [x] 礼品卡页面 (GiftCard) -> 用户模块 (`pages/wallet/gift-card`)
- [x] 绑定实体卡页面 (BindCard) -> 用户模块 (`pages/user/bind-card`)
- [x] 搜索页面 (Search) -> 搜索模块 (`pages/search/search`)
- [x] 收藏页面 (Favorite) -> 收藏模块 (`pages/favorite/favorite`)

## 第二阶段：全局优化与自检 (Optimization & Self-Check)
- [x] **[API 强化]** 补齐上述“缺失接口清单”中的所有函数。【接口检查：参数与返回结构已对齐】
- [x] **[API 强化]** 修复 `utils/request.js` 导出 `uploadFile` 并统一 Timeout 为 10s。【接口检查：参数与返回结构已对齐】
- [ ] 检查所有页面的 `onLoad` 和 `onShow` 逻辑，确保数据刷新及时。
- [ ] 检查所有 API 调用的错误处理，确保有友好的 Toast 提示。
- [ ] 检查所有图片的 `mode` 属性，确保在不同屏幕下显示正常。
- [ ] 检查 `app.json` 中的 `tabBar` 配置，确保图标和路径正确。
- [ ] 检查 `utils/request.js` 中的 Token 处理逻辑，确保登录态失效时能自动跳转登录页。

## 第三阶段：发布准备 (Release Preparation)
- [ ] 压缩图片资源。
- [ ] 清理无用的代码和注释。
- [ ] 确认 `project.config.json` 配置正确。