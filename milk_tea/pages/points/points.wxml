<!--pages/points/points.wxml-->
<view class="points-page">
  <!-- 积分卡片 -->
  <view class="points-card">
    <view class="card-bg"></view>
    <view class="card-content">
      <view class="points-info">
        <text class="points-label">我的积分</text>
        <text class="points-value">{{userPoints}}</text>
      </view>
      <view class="card-actions">
        <view class="action-btn" bindtap="toggleRecords">
          <image class="action-icon" src="/images/icons/history.png"></image>
          <text>兑换记录</text>
        </view>
        <view class="action-btn" bindtap="goToRules">
          <image class="action-icon" src="/images/icons/info.png"></image>
          <text>积分规则</text>
        </view>
      </view>
    </view>
  </view>

  <!-- 分类标签 -->
  <view class="category-tabs">
    <view 
      class="tab-item {{activeCategoryId === item.id ? 'active' : ''}}"
      wx:for="{{categories}}"
      wx:key="id"
      bindtap="selectCategory"
      data-id="{{item.id}}"
    >
      {{item.name}}
    </view>
  </view>

  <!-- 商品列表 -->
  <scroll-view class="product-scroll" scroll-y>
    <view class="product-list">
      <view 
        class="product-item"
        wx:for="{{productList}}"
        wx:key="id"
        wx:if="{{activeCategoryId === 'all' || item.category === activeCategoryId}}"
      >
        <image class="product-image" src="{{item.image}}" mode="aspectFill"></image>
        <view class="product-info">
          <text class="product-name">{{item.name}}</text>
          <text class="product-desc">{{item.description}}</text>
          <view class="product-footer">
            <view class="points-price">
              <text class="points-num">{{item.points}}</text>
              <text class="points-unit">积分</text>
            </view>
            <button 
              class="exchange-btn" 
              bindtap="exchangeProduct" 
              data-id="{{item.id}}"
              disabled="{{userPoints < item.points || item.stock <= 0}}"
            >
              {{item.stock > 0 ? '立即兑换' : '已兑完'}}
            </button>
          </view>
          <view class="stock-info" wx:if="{{item.stock <= 10}}">
            <text>仅剩{{item.stock}}件</text>
          </view>
        </view>
      </view>
    </view>

    <!-- 空状态 -->
    <view class="empty-tip" wx:if="{{productList.length === 0 && !loading}}">
      <image class="empty-icon" src="/images/icons/gift.png"></image>
      <text>暂无可兑换商品</text>
    </view>
  </scroll-view>

  <!-- 兑换记录弹窗 -->
  <view class="records-modal" wx:if="{{showRecords}}">
    <view class="modal-mask" bindtap="hideRecords"></view>
    <view class="modal-content">
      <view class="modal-header">
        <text class="modal-title">兑换记录</text>
        <image class="close-icon" src="/images/icons/close.png" bindtap="hideRecords"></image>
      </view>
      <scroll-view class="modal-body" scroll-y>
        <view class="empty-records">
          <image class="empty-icon" src="/images/icons/history.png"></image>
          <text>暂无兑换记录</text>
        </view>
      </scroll-view>
    </view>
  </view>
</view>
