<!--pages/pickup/pickup.wxml-->
<view class="pickup-page">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading" wx:if="{{loading}}">
    <view class="loading-icon"></view>
    <text>åŠ è½½ä¸­...</text>
  </view>

  <view wx:else>
    <!-- å¾…å–é¤è®¢å• -->
    <view class="pending-section" wx:if="{{pendingOrders.length > 0}}">
      <!-- å–é¤ç å¤§å¡ç‰‡ -->
      <view class="pickup-card" wx:if="{{activeOrder}}">
        <view class="card-header">
          <view class="status-badge {{activeOrder.status}}">{{activeOrder.statusText}}</view>
          <text class="order-no">{{activeOrder.orderNo}}</text>
        </view>

        <view class="pickup-code-section">
          <text class="label">å–é¤ç </text>
          <text class="pickup-code">{{activeOrder.pickupCode}}</text>
          <text class="hint">è¯·å‡ºç¤ºæ­¤ç ç»™åº—å‘˜</text>
        </view>

        <view class="order-info">
          <view class="info-item">
            <text class="icon">ğŸª</text>
            <view class="info-detail">
              <text class="store-name">{{activeOrder.store.name}}</text>
              <text class="store-address">{{activeOrder.store.address}}</text>
            </view>
          </view>
          
          <view class="info-item" wx:if="{{activeOrder.status === 'ready'}}">
            <text class="icon">â°</text>
            <view class="info-detail">
              <text class="time-label">å·²å¤‡é¤</text>
              <text class="time-value">è¯·å°½å¿«å‰å¾€å–é¤</text>
            </view>
          </view>

          <view class="info-item" wx:if="{{activeOrder.status === 'processing'}}">
            <text class="icon">â°</text>
            <view class="info-detail">
              <text class="time-label">é¢„è®¡å®Œæˆ</text>
              <text class="time-value">{{activeOrder.estimatedTime}}</text>
            </view>
          </view>
        </view>

        <view class="order-items">
          <view class="items-header">
            <text>å•†å“æ¸…å•</text>
            <text class="item-count">å…±{{activeOrder.itemCount}}ä»¶</text>
          </view>
          <view class="item" wx:for="{{activeOrder.items}}" wx:key="id">
            <image class="item-image" src="{{item.image}}" mode="aspectFill"></image>
            <view class="item-info">
              <text class="item-name">{{item.name}}</text>
              <text class="item-specs" wx:if="{{item.customizations}}">{{item.customizations}}</text>
            </view>
            <text class="item-quantity">Ã—{{item.quantity}}</text>
          </view>
        </view>

        <view class="card-actions">
          <button class="action-btn" bindtap="callStore" data-phone="{{activeOrder.store.phone}}">
            <text class="icon">ğŸ“</text>
            <text>è”ç³»é—¨åº—</text>
          </button>
          <button class="action-btn" wx:if="{{activeOrder.status === 'processing'}}" bindtap="remindOrder" data-id="{{activeOrder.id}}">
            <text class="icon">â°</text>
            <text>å‚¬å•</text>
          </button>
          <button class="action-btn primary" bindtap="goToOrderDetail" data-id="{{activeOrder.id}}">
            <text>æŸ¥çœ‹è¯¦æƒ…</text>
          </button>
        </view>
      </view>

      <!-- å…¶ä»–å¾…å–é¤è®¢å• -->
      <view class="other-orders" wx:if="{{pendingOrders.length > 1}}">
        <view class="section-title">å…¶ä»–å¾…å–é¤è®¢å•</view>
        <view class="order-list">
          <view class="order-item {{activeOrder.id === item.id ? 'active' : ''}}" 
                wx:for="{{pendingOrders}}" 
                wx:key="id"
                bindtap="selectOrder"
                data-id="{{item.id}}">
            <view class="order-header">
              <text class="pickup-code-small">{{item.pickupCode}}</text>
              <text class="status">{{item.statusText}}</text>
            </view>
            <text class="order-no">{{item.orderNo}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- æ‰«ç å–é¤ -->
    <view class="scan-section">
      <button class="scan-btn" bindtap="scanToPickup">
        <text class="icon">ğŸ“·</text>
        <text class="text">æ‰«ç å–é¤</text>
      </button>
      <text class="scan-hint">æ‰«æé—¨åº—äºŒç»´ç å¿«é€Ÿå–é¤</text>
    </view>

    <!-- å†å²è®¢å• -->
    <view class="history-section" wx:if="{{historyOrders.length > 0}}">
      <view class="section-title">å†å²å–é¤è®°å½•</view>
      <view class="history-list">
        <view class="history-item" wx:for="{{historyOrders}}" wx:key="id" bindtap="goToOrderDetail" data-id="{{item.id}}">
          <view class="history-left">
            <text class="pickup-code">{{item.pickupCode}}</text>
            <text class="order-no">{{item.orderNo}}</text>
            <text class="picked-time">{{item.pickedTime}}</text>
          </view>
          <view class="history-right">
            <text class="amount">Â¥{{item.totalAmount}}</text>
            <text class="arrow">â€º</text>
          </view>
        </view>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{pendingOrders.length === 0 && historyOrders.length === 0}}">
      <image class="empty-icon" src="/images/empty/pickup.png" mode="aspectFit"></image>
      <text class="empty-text">æš‚æ— å–é¤è®¢å•</text>
      <button class="go-order-btn" bindtap="goToOrder">å»ç‚¹å•</button>
    </view>
  </view>
</view>
