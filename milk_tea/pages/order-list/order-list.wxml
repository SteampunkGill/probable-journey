<!--pages/order-list/order-list.wxml-->
<view class="order-list-page">
  <!-- 标签页 -->
  <view class="tabs">
    <view class="tab {{activeTab === item.key ? 'active' : ''}}" 
          wx:for="{{tabs}}" 
          wx:key="key"
          bindtap="switchTab" 
          data-tab="{{item.key}}">
      {{item.name}}
    </view>
  </view>

  <!-- 订单列表 -->
  <view class="orders" wx:if="{{orders.length > 0}}">
    <view class="order-item" wx:for="{{orders}}" wx:key="orderNo" bindtap="goToOrderDetail" data-no="{{item.orderNo}}">
      <!-- 订单头部 -->
      <view class="order-header">
        <text class="order-no">订单号：{{item.orderNo}}</text>
        <text class="order-status {{item.status}}">{{item.statusText}}</text>
      </view>

      <!-- 商品列表 -->
      <view class="goods-list">
        <view class="goods-item" wx:for="{{item.items}}" wx:key="id" wx:for-item="goods">
          <image class="goods-image" src="{{goods.productImage}}" mode="aspectFill"></image>
          <view class="goods-info">
            <text class="goods-name">{{goods.productName}}</text>
            <view class="goods-bottom">
              <text class="goods-price">¥{{goods.price}}</text>
              <text class="goods-quantity">×{{goods.quantity}}</text>
            </view>
          </view>
        </view>
      </view>

      <!-- 订单信息 -->
      <view class="order-info">
        <view class="info-row">
          <text class="label">下单时间</text>
          <text class="value">{{item.orderTime}}</text>
        </view>
        <view class="info-row" wx:if="{{item.pickupCode}}">
          <text class="label">取餐码</text>
          <text class="pickup-code">{{item.pickupCode}}</text>
        </view>
        <view class="info-row total">
          <text class="label">实付款</text>
          <text class="amount">¥{{item.actualAmount}}</text>
        </view>
      </view>

      <!-- 操作按钮 -->
      <view class="order-actions">
        <!-- 待支付 -->
        <block wx:if="{{item.status === 'PENDING_PAYMENT'}}">
          <button class="action-btn secondary" catchtap="cancelOrder" data-no="{{item.orderNo}}">取消订单</button>
          <button class="action-btn primary" catchtap="payOrder" data-no="{{item.orderNo}}">去支付</button>
        </block>

        <!-- 制作中 -->
        <block wx:if="{{item.status === 'MAKING' || item.status === 'PAID'}}">
          <button class="action-btn secondary" catchtap="contactService" data-no="{{item.orderNo}}">联系客服</button>
          <button class="action-btn primary" catchtap="remindOrder" data-no="{{item.orderNo}}">催单</button>
        </block>

        <!-- 已完成 -->
        <block wx:if="{{item.status === 'COMPLETED'}}">
          <button class="action-btn secondary" catchtap="reorder" data-no="{{item.orderNo}}">再来一单</button>
          <button class="action-btn primary" wx:if="{{!item.isCommented}}" catchtap="reviewOrder" data-no="{{item.orderNo}}">去评价</button>
        </block>
      </view>
    </view>
  </view>

  <!-- 空状态 -->
  <view class="empty-state" wx:elif="{{!loading}}">
    <image class="empty-icon" src="/images/empty/order.png" mode="aspectFit"></image>
    <text class="empty-text">暂无订单</text>
    <button class="go-shopping-btn" bindtap="goToIndex">去逛逛</button>
  </view>

  <!-- 加载状态 -->
  <view class="loading-more" wx:if="{{loading && orders.length > 0}}">
    <text>加载中...</text>
  </view>

  <!-- 没有更多 -->
  <view class="no-more" wx:if="{{!hasMore && orders.length > 0}}">
    <text>没有更多了</text>
  </view>
</view>
