<!-- pages/search/search.wxml -->
<view class="search-page" style="background-color: #FFF8F0;">
  <!-- 搜索栏 -->
  <view class="search-header">
    <view class="search-input-wrapper">
      <!-- 使用本地图标 -->
      <input 
        type="text" 
        placeholder="搜索奶茶、咖啡、小食..." 
        value="{{searchKeyword}}"
        bindinput="onKeywordInput"
        bindconfirm="onSearch"
        confirm-type="search"
        focus="{{autoFocus}}"
      />
      <text 
        class="iconfont icon-close" 
        wx:if="{{searchKeyword}}" 
        bindtap="clearKeyword"
      ></text>
    </view>
    <!-- 将搜索图标放在取消按钮的位置，并添加点击事件 -->
    <image 
      src="/images/icons/search.png" 
      class="search-action-icon" 
      bindtap="onSearch"
      mode="aspectFit"
    />
  </view>

  <!-- 搜索历史 -->
  <view class="search-history" wx:if="{{!showResults && searchHistory.length > 0}}">
    <view class="history-header">
      <text class="history-title">搜索历史</text>
      <text class="iconfont icon-delete" bindtap="clearHistory"></text>
    </view>
    <view class="history-tags">
      <text 
        class="history-tag" 
        wx:for="{{searchHistory}}" 
        wx:key="index"
        bindtap="searchByHistory"
        data-keyword="{{item}}"
      >
        {{item}}
      </text>
    </view>
  </view>

  <!-- 热门搜索 -->
  <view class="hot-search" wx:if="{{!showResults}}">
    <view class="hot-header">
      <text class="hot-title">热门搜索</text>
    </view>
    <view class="hot-tags">
      <text 
        class="hot-tag {{index < 3 ? 'hot' : ''}}" 
        wx:for="{{hotKeywords}}" 
        wx:key="word"
        bindtap="searchByHot"
        data-keyword="{{item.word}}"
      >
        {{index + 1}}. {{item.word}}
      </text>
    </view>
  </view>

  <!-- 搜索建议 -->
  <view class="search-suggest" wx:if="{{showSuggest && searchKeyword && !showResults}}">
    <view class="suggest-list">
      <view 
        class="suggest-item" 
        wx:for="{{searchSuggest}}" 
        wx:key="index"
        bindtap="searchBySuggest"
        data-keyword="{{item}}"
      >
        <image src="/images/icons/search.png" class="suggest-icon"></image>
        <text class="suggest-text">{{item}}</text>
      </view>
    </view>
  </view>

  <!-- 搜索结果 -->
  <view class="search-results" wx:if="{{showResults}}">
    <!-- 搜索结果头部 -->
    <view class="results-header">
      <text class="results-count">
        找到{{searchResults.length}}个相关商品
      </text>
      <view class="sort-options">
        <text 
          class="sort-option {{sortBy === 'default' ? 'active' : ''}}" 
          bindtap="changeSort"
          data-sort="default"
        >
          综合
        </text>
        <text 
          class="sort-option {{sortBy === 'sales' ? 'active' : ''}}" 
          bindtap="changeSort"
          data-sort="sales"
        >
          销量
        </text>
        <text 
          class="sort-option {{sortBy === 'price_asc' ? 'active' : ''}}" 
          bindtap="changeSort"
          data-sort="price_asc"
        >
          价格 ↑
        </text>
        <text 
          class="sort-option {{sortBy === 'price_desc' ? 'active' : ''}}" 
          bindtap="changeSort"
          data-sort="price_desc"
        >
          价格 ↓
        </text>
      </view>
    </view>

    <!-- 筛选条件 -->
    <view class="filter-options" wx:if="{{showFilters}}">
      <scroll-view class="filter-scroll" scroll-x="true">
        <view class="filter-tags">
          <text 
            class="filter-tag {{activeCategory === '' ? 'active' : ''}}" 
            bindtap="filterByCategory"
            data-category=""
          >
            全部
          </text>
          <text 
            class="filter-tag {{activeCategory === category.id ? 'active' : ''}}" 
            wx:for="{{categories}}" 
            wx:key="id"
            bindtap="filterByCategory"
            data-category="{{category.id}}"
          >
            {{category.name}}
          </text>
        </view>
      </scroll-view>
    </view>

    <!-- 商品列表 -->
    <view class="product-list">
      <view class="product-grid">
        <product-card 
          wx:for="{{filteredResults}}" 
          wx:key="id"
          product="{{item}}"
          bind:tap="onProductTap"
          bind:favoritechange="onFavoriteChange"
          bind:addtocart="onAddToCart"
        ></product-card>
      </view>
    </view>

    <!-- 空结果提示 -->
    <view class="empty-results" wx:if="{{searchResults.length === 0 && showResults}}">
      <image src="/images/empty-search.png" class="empty-icon"></image>
      <text class="empty-text">没有找到相关商品</text>
      <text class="empty-hint">换个关键词试试吧</text>
      <button class="btn btn-secondary" bindtap="resetSearch">
        重新搜索
      </button>
    </view>
  </view>
</view>